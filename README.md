# Тестовое задание "Создание REST API приложения" на FastAPI

## Необходимо реализовать REST API приложения для справочника *Организаций, Зданий, Деятельности.*

## Функциональные требования:
### Взаимодействие с пользователем происходит посредством HTTP запросов к API серверу с использованием статического API ключа. Все ответы должны быть в формате JSON.  Необходимо реализовать следующие методы:
- список всех организаций находящихся в конкретном здании
- список всех организаций, которые относятся к указанному виду деятельности
- список организаций, которые находятся в заданном радиусе/прямоугольной области относительно указанной точки на карте. список зданий
- вывод информации об организации по её идентификатору
- искать организации по виду деятельности. Например, поиск по виду деятельности «Еда», которая находится на первом уровне дерева, и чтобы нашлись все организации, которые относятся к видам деятельности, лежащим внутри. Т.е. в результатах поиска должны отобразиться организации с видом деятельности Еда, Мясная продукция, Молочная продукция.
- поиск организации по названию
- ограничить уровень вложенности деятельностей 3 уровням

### Технические требования:
- FastAPI
- Pydantic
- SQLalchemy
- alembic

## Реализовано:
- Все CRUD операции с описанием
- Все функции согласно "Функциональным требованиям"
- Все функции проверяются статичным API-ключом/паролем (записан в *.env.example*)
- Заготовлена резервная копия базы данных с тестовыми данными (устанавливаются автоматически при сборке Docker контейнера)
- Оформлена документация в Swagger
- Docker файлы для создания Docker-контейнера с тестовыми данным

## Стек:
- Python 3.11
- fastapi 0.119.1
- alembic 1.17.0
- SQLAlchemy 2.0.44  
***Подробнее о библиотеках и фреймворках в файле requirements.txt***

## Таблицы
### Таблица Организация 
| Поле          | Тип         | Описание                             |
| ------------- | ----------- | ------------------------------------ |
| `id`          | SERIAL (PK) | Уникальный идентификатор организации |
| `name`        | VARCHAR     | Название организации                 |
| `building_id` | INT (FK)    | Ссылка на здание (`building.id`)     |

### Таблица Деятельность
| Поле        | Тип         | Описание                                                |
| ----------- | ----------- | ------------------------------------------------------- |
| `id`        | SERIAL (PK) | Уникальный идентификатор вида деятельности              |
| `name`      | VARCHAR     | Название вида деятельности                              |
| `parent_id` | INT (FK)    | Ссылка на родительский вид деятельности (`activity.id`) |


### Таблица organization_activity(связь многие ко многим)
| Поле              | Тип      | Описание                                   |
| ----------------- | -------- | ------------------------------------------ |
| `organization_id` | INT (FK) | Ссылка на организацию (`organization.id`)  |
| `activity_id`     | INT (FK) | Ссылка на вид деятельности (`activity.id`) |


### Таблица Здание
| Поле        | Тип              | Описание                        |
| ----------- | ---------------- | ------------------------------- |
| `id`        | SERIAL (PK)      | Уникальный идентификатор здания |
| `address`   | VARCHAR          | Адрес здания                    |
| `latitude`  | DOUBLE PRECISION | Географическая широта           |
| `longitude` | DOUBLE PRECISION | Географическая долгота          |


### Таблица Телефонные номера
| Поле              | Тип         | Описание                                  |
| ----------------- | ----------- | ----------------------------------------- |
| `id`              | SERIAL (PK) | Уникальный идентификатор номера           |
| `number`          | VARCHAR     | Телефонный номер                          |
| `organization_id` | INT (FK)    | Ссылка на организацию (`organization.id`) |

## Связи
- organization.building_id → building.id (многие к одному)
- phone_number.organization_id → organization.id (многие к одному)
- organization_activity.organization_id → organization.id (многие ко многому)
- organization_activity.activity_id → activity.id (многие ко многому)
- activity.parent_id → activity.id (один к многим, иерархия)

## Запуск из Docker
**Реализован Docker контейнер. Для его использования необходим установленный и запущенный Docker Desktop.**  
### Инструкцию по разворачиванию контейнера. 
### Необходимо:  
**1. Создать файл окружения .env в папке проекта (рядом с файлами *main.py, README.md, Dockerfile*)**  
**2. В корне проекта ввести команды:**    
```cp .env.example .env```  
```docker compose up --build```    
#### Описание:
**Первая команда копирует содержимое *.env.example* файла в *.env* файл, данные из которого Docker использует для создания контейнера.**  
**Вторая команда запускает работу Docker - создание контейнера.**  
**После ввода команд появится и запустится Docker-контейнер с приложением. В контейнер загружается файл *dump_db.sql* - база данных с тестовыми данными.**  
**Проект будет доступен по адресу *[локального сервера](http://localhost:8000)*. Далее можно перейти в *[Swagger-документацию](http://localhost:8000/docs)* для использования всех функций.**  

***Для удаления Docker контейнера, необходимо ввести команду:***  
```docker compose down -v```

## Запуск из PyCharm
**Для корректной работы на устройстве: должен быть установлен PostgreSQL (Например: *СУБД pgAdmin 4*), необходимо создать и корректно заполнить *.env* файл. В проекте находится файл *.env.example* - пример/шаблон файла окружения.**  
**После настройки файла окружения, для работы приложения, необходимо запустить файл app/main.py**  
**Запустится *[локальный сервер](http://localhost:8000)*, URL которого необходимо открыть в браузере. Для использования функций можно использовать *[Swagger-документацию.](http://localhost:8000/docs)***  

### Адреса
***Локальный сервер: http://localhost:8000***  
***Swagger-документация: http://localhost:8000/docs***

